---
---
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>{{ site.title }}</title>
    <meta name="description" content="{{ site.description }}">
    <link
      rel="stylesheet"
      type="text/css"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    >
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ site.baseurl }}/static/css/deadlines.css"
      media="screen,projection"
    >
    <link
      rel="shortcut icon"
      href="{{ site.baseurl }}/static/img/favicon.png"
    >
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <div class="top-strip"></div>
    <div class="container">
      <div class="page-header">
        <div class="row">
          <div class="col-xs-12 col-sm-8">
            <h1>
              {{ site.title }}<br>
            </h1>
          </div>
          <div class="col-xs-12">
            {{ site.description }}
            <p>Last update: {{ site.time | date: "%-d %B %Y" }}</p>
          </div>
        </div>
        <hr>
      </div>

      <div class="conf-container">
        {% comment %}
          Loop over each entry in rawsubs.json. We assume rawsubs.json lives in _data/rawsubs.json,
          so that Jekyll exposes it as site.data.rawsubs.
        {% endcomment %}
        {% for sub in site.data.rawsubs %}
          {% comment %}
            Create a unique ID using the array index, or any combination of fields.
            Here we use the forloop.index0 (zero-based) so each block has a distinct ID.
          {% endcomment %}
          {% assign sub_id = "rawsub-" | append: forloop.index0 %}
          <div id="{{ sub_id }}" class="conf">
            <div class="row">
              <!-- Left column: Title + Link -->
              <div class="col-xs-12 col-sm-6">
                <h2>
                  <a href="{{ sub.trackUrl }}">
                    {{ sub.linkText }}
                  </a>
                </h2>
                <div class="meta">
                  <!-- Show the "type" field from rawsubs.json -->
                  <strong>Type:</strong> {{ sub.type }}<br>
                  <!-- Show the "location" field -->
                  <strong>Location:</strong> {{ sub.location }}
                </div>
              </div>

              <!-- Right column: Deadline countdown -->
              <div class="col-xs-12 col-sm-6">
                <span class="timer"></span>
                <div class="deadline">
                  <div>
                    <strong>Deadline:</strong>
                    <!-- 
                      We store the raw millisecond timestamp directly in a data attribute.
                      Later, JS (using Moment.js) will read data-millis and write a formatted date.
                    -->
                    <span
                      class="deadline-time"
                      data-millis="{{ sub.millis }}"
                    >
                      <!-- 
                        Fallback: Jekyll cannot natively convert UNIX millis to a date, so
                        leave this text blank or show a placeholder. JS will fill it. 
                      -->
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <hr>
          </div>
        {% endfor %}
      </div>

      <footer>
        <a href="https://github.com/doehyunbaek/deadlines">Source Repository</a>.
      </footer>
    </div>

    <!-- Include Moment.js and countdown plugin as before -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery.countdown/2.2.0/jquery.countdown.min.js"
      integrity="sha512-lteuRD+aUENrZPTXWFRPTBcDDxIGWe5uu0apPEn+3ZKYDwDaEErIK9rvR0QzUGmUQ55KFE2RqGTVoZsKctGMVw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
      integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data-10-year-range.min.js"
      integrity="sha512-d11VXfxQMn+sZuIgzHITdIuInr4cVRGV/uLiSI643WH/J+p4gPFYSHXRMR2v+w4Rn2TSyzJjsZjc0M7+Qd+UXw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/store.js/2.0.12/store.legacy.min.js"
      integrity="sha512-3yZTInL4yLU1ajnca35KTk6YE4RPHJU2y+jbhHAykE9OzMHpc2BIJghNsbkBNacIJWLLUmUkLEGPDDWrFY2zzw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <!-- 
      Inline JS: find every .deadline-time, read data-millis, convert via Moment,
      and also initialize the countdown plugin if desired. 
    -->
    <script>
      $(document).ready(function() {
        $('.deadline-time').each(function() {
          var $span = $(this);
          // Read the raw UNIX timestamp (in milliseconds)
          var millis = parseInt($span.attr('data-millis'), 10);
          if (!isNaN(millis)) {
            // Convert to moment object
            var m = moment(millis);
            // Format however you like; for example: "D MMM YYYY, h:mm A"
            var formatted = m.format('D MMMM YYYY, HH:mm');
            $span.text(formatted);

            // OPTIONAL: If you want a live countdown inside the ".timer" sibling:
            //   $(this).closest('.conf').find('.timer').countdown(m.toDate(), function(event) {
            //     $(this).text(event.strftime('%D days %H:%M:%S'));
            //   });
            //
            // The above is just an example; adjust format string as you wish.
          }
        });
      });
    </script>

    <!-- Load your existing main.js as before -->
    <script src="{{ site.baseurl }}/static/js/main.js" async></script>
    {% if site.ga_id %}
      {% include analytics.html %}
    {% endif %}
  </body>
</html>
